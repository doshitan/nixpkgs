# This file is autogenerated! Do not edit it yourself, use ../update.py for regeneration.
{ stdenv, fetchgit, arcanist, libphutil, php }:

stdenv.mkDerivation rec {
  name = "phabricator-${version}";
  version = "2016-09-09";

  src = fetchgit {
    url = "https://github.com/phacility/phabricator.git";
    rev = "32a580c720e31b0e4d7c5e8846870e8ce9fe3978";
    sha256 = "1g96gz6hn4wwqfw11af74hf788nxl03li3xcq5hb40wsjnmg6mv6";
  };

  buildInputs = [ php arcanist libphutil ];

  patches = [ ./conf.patch ];

  installPhase = ''
    mkdir -p $out/libexec
    cp -R . $out/libexec/phabricator
    ln -s ${libphutil}/libexec/libphutil $out/libexec/libphutil
    ln -s ${arcanist}/libexec/arcanist $out/libexec/arcanist
  '';

  meta = {
    description = "A collection of web applications which help software companies build better software";
    homepage    = "http://phabricator.org";
    license     = stdenv.lib.licenses.asl20;
    platforms   = stdenv.lib.platforms.unix;
  };
}
